{"pageProps":{"postData":{"id":"tagging_markdown_content","contentHtml":"<p>I had a bunch of markdown files filled with notes that I wanted to add to my blog. The challenge was to tag each file with relevant topics. To tackle this, I decided to use a language model and wrote a bash script to automate the tagging process.</p>\n<p>Now, all my markdown notes are semantically tagged and ready for the blog! However, there's a small hiccup: all the metadata dates are the same, which looks odd. But that's okay â€” I plan to review and post each blog entry gradually anyway.</p>\n<div class=\"hl hl-bash\"><div class=\"hl-header\"><div class=\"hl-language\"><span>bash</span></div></div><pre id=\"MC45NTMzODY1\" style=\"--hl-line-number-gutter-factor: 2\"><code tabindex=\"0\"><span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">1</span><span class=\"pl-c\">#!/bin/bash</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">2</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">3</span><span class=\"pl-en\">resolve_tags</span>() {</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">4</span>    <span class=\"pl-k\">if</span> [[ <span class=\"pl-k\">-f</span> .env ]]<span class=\"pl-k\">;</span> <span class=\"pl-k\">then</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">5</span>        <span class=\"pl-k\">export</span> <span class=\"pl-s\"><span class=\"pl-pds\">$(</span>grep -v <span class=\"pl-pds\">'</span>^#<span class=\"pl-pds\">'</span> .env <span class=\"pl-k\">|</span> xargs<span class=\"pl-pds\">)</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">6</span>    <span class=\"pl-k\">else</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">7</span>        <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>.env file not found. Exiting...<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">8</span>        <span class=\"pl-c1\">exit</span> 1</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">9</span>    <span class=\"pl-k\">fi</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">10</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">11</span>    <span class=\"pl-k\">if</span> [[ <span class=\"pl-k\">-z</span> <span class=\"pl-smi\">$OPEN_AI_KEY</span> ]]<span class=\"pl-k\">;</span> <span class=\"pl-k\">then</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">12</span>        <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>OPEN_AI_KEY is not set in the .env file. Exiting...<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">13</span>        <span class=\"pl-c1\">exit</span> 1</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">14</span>    <span class=\"pl-k\">fi</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">15</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">16</span>    <span class=\"pl-k\">local</span> title=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$1</span><span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">17</span>    <span class=\"pl-k\">local</span> ai_prompt=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Create a series of topic tags from the following title, reply with only the comma separated tags in the format 'tag, tag, tag' no additional information or text, at least one of these tags must be used (Ai, Analysis, Economy, Engineering, Hacking, Philosophy, Research, Snippets, Tinkering, Privacy). The title is: <span class=\"pl-smi\">$title</span><span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">18</span>    <span class=\"pl-k\">local</span> response=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>curl https://api.openai.com/v1/chat/completions \\</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">19</span><span class=\"pl-s\">    -H <span class=\"pl-pds\">\"</span>Content-Type: application/json<span class=\"pl-pds\">\"</span> \\</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">20</span><span class=\"pl-s\">    -H <span class=\"pl-pds\">\"</span>Authorization: Bearer <span class=\"pl-smi\">$OPEN_AI_KEY</span><span class=\"pl-pds\">\"</span> \\</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">21</span><span class=\"pl-s\">    -d <span class=\"pl-pds\">'</span>{</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">22</span><span class=\"pl-s\">        \"model\": \"gpt-4o\",</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">23</span><span class=\"pl-s\">        \"store\": true,</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">24</span><span class=\"pl-s\">        \"messages\": [</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">25</span><span class=\"pl-s\">            {\"role\": \"user\", \"content\": \"<span class=\"pl-pds\">'\"</span><span class=\"pl-smi\">$ai_prompt</span><span class=\"pl-pds\">\"'</span>\"}</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">26</span><span class=\"pl-s\">        ]</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">27</span><span class=\"pl-s\">        }<span class=\"pl-pds\">'</span> <span class=\"pl-k\">|</span> jq -r <span class=\"pl-pds\">'</span>.choices[0].message.content<span class=\"pl-pds\">')</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">28</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">29</span>    <span class=\"pl-c\"># Parse tags from the response of the AI (lowercase all, tags are separated by commas)</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">30</span>    <span class=\"pl-k\">local</span> tags=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>echo <span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$response</span><span class=\"pl-pds\">\"</span> <span class=\"pl-k\">|</span> tr <span class=\"pl-pds\">'</span>[:upper:]<span class=\"pl-pds\">'</span> <span class=\"pl-pds\">'</span>[:lower:]<span class=\"pl-pds\">'</span> <span class=\"pl-k\">|</span> tr -d <span class=\"pl-pds\">'</span>\\\"<span class=\"pl-pds\">'</span> <span class=\"pl-k\">|</span> tr -d <span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\")</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">31</span>    <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$tags</span><span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">32</span>}</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">33</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">34</span><span class=\"pl-c\"># Example usage</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">35</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">36</span>find <span class=\"pl-c1\">.</span> -type f -name <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>*.md<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">|</span> <span class=\"pl-k\">while</span> <span class=\"pl-c1\">read</span> -r file<span class=\"pl-k\">;</span> <span class=\"pl-k\">do</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">37</span>    first_line=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>head -n 1 <span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$file</span><span class=\"pl-pds\">\")</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">38</span>    <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Processing file: <span class=\"pl-smi\">$file</span><span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">39</span>    <span class=\"pl-k\">if</span> [[ <span class=\"pl-smi\">$first_line</span> <span class=\"pl-k\">!=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>---<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">&#x26;&#x26;</span> <span class=\"pl-smi\">$first_line</span> <span class=\"pl-k\">==</span> <span class=\"pl-cce\">\\#</span><span class=\"pl-k\">*</span> ]]<span class=\"pl-k\">;</span> <span class=\"pl-k\">then</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">40</span>        title=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>echo <span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$first_line</span><span class=\"pl-pds\">\"</span> <span class=\"pl-k\">|</span> sed <span class=\"pl-pds\">'</span>s/^# //<span class=\"pl-pds\">')</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">41</span>        <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Title: <span class=\"pl-smi\">$title</span><span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">42</span>        tags=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>resolve_tags <span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$title</span><span class=\"pl-pds\">\")</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">43</span>        {</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">44</span>            <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>---<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">45</span>            <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>title: '<span class=\"pl-smi\">$title</span>'<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">46</span>            <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>date: '<span class=\"pl-pds\">$(</span>date +<span class=\"pl-pds\">\"</span>%Y-%m-%d<span class=\"pl-pds\">\")</span>'<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">47</span>            <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tags: '<span class=\"pl-smi\">$tags</span>'<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">48</span>            <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>---<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">49</span>            tail -n +2 <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$file</span><span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">50</span>        } <span class=\"pl-k\">></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$file</span>.tmp<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">&#x26;&#x26;</span> mv <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$file</span>.tmp<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$file</span><span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">51</span>    <span class=\"pl-k\">fi</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">52</span><span class=\"pl-k\">done</span></span>\n</code></pre></div>","title":"Tagging markdown content","date":"2025-01-15","tags":["snippets","tinkering","research"]}},"__N_SSG":true}