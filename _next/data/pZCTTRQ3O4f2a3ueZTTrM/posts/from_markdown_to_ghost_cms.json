{"pageProps":{"postData":{"id":"from_markdown_to_ghost_cms","contentHtml":"<p>This script accepts a directory of markdown files and publishes them to a ghost cms instance.</p>\n<p>This is a good way to publish a whole raft of notes very quickly if you have a ghost cms instance setup.</p>\n<p>I used this template on github: <a href=\"https://github.com/clean-docker/ghost-cms\">clean-docker/ghost-cms</a></p>\n<p>This was simply a test to see if it was possible to do this. which it was, unfortunately it doesn't handle snippets very well, and simply ignores syntax highlighting as well as code formatting.</p>\n<div class=\"hl hl-python\"><div class=\"hl-header\"><div class=\"hl-language\"><span>python</span></div></div><pre id=\"MC43NTI0OTEy\" style=\"--hl-line-number-gutter-factor: 2\"><code tabindex=\"0\"><span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">1</span><span class=\"pl-k\">import</span> requests</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">2</span><span class=\"pl-k\">import</span> markdown2</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">3</span><span class=\"pl-k\">import</span> jwt</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">4</span><span class=\"pl-k\">import</span> datetime</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">5</span><span class=\"pl-k\">import</span> os</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">6</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">7</span><span class=\"pl-c\"># Replace these with your Ghost CMS details</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">8</span>api_url <span class=\"pl-k\">=</span> os.getenv(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>GHOST_API_URL<span class=\"pl-pds\">'</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">9</span>admin_api_key <span class=\"pl-k\">=</span> os.getenv(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>GHOST_ADMIN_KEY<span class=\"pl-pds\">'</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">10</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">11</span><span class=\"pl-k\">def</span> <span class=\"pl-en\">markdown_to_html</span>(<span class=\"pl-smi\">file_path</span>):</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">12</span>    <span class=\"pl-c\"># Extract the title from the file name</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">13</span>    title <span class=\"pl-k\">=</span> file_path.split(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>/<span class=\"pl-pds\">'</span></span>)[<span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>].replace(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>_<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span> <span class=\"pl-pds\">'</span></span>).replace(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>.md<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">''</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">14</span>    <span class=\"pl-c\"># Read the markdown file</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">15</span>    <span class=\"pl-k\">with</span> <span class=\"pl-c1\">open</span>(file_path, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>r<span class=\"pl-pds\">'</span></span>) <span class=\"pl-k\">as</span> <span class=\"pl-v\">file</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">16</span>        lines <span class=\"pl-k\">=</span> <span class=\"pl-v\">file</span>.readlines()</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">17</span>    <span class=\"pl-c\"># Remove the first line</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">18</span>    content <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">''</span></span>.join(lines[<span class=\"pl-c1\">1</span>:])</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">19</span>    <span class=\"pl-c\"># Convert markdown to HTML</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">20</span>    html <span class=\"pl-k\">=</span> markdown2.markdown(content)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">21</span>    <span class=\"pl-k\">return</span> title, html</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">22</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">23</span><span class=\"pl-k\">def</span> <span class=\"pl-en\">process_markdown_directory</span>(<span class=\"pl-smi\">directory_path</span>):</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">24</span>    results <span class=\"pl-k\">=</span> []</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">25</span>    <span class=\"pl-k\">for</span> file_name <span class=\"pl-k\">in</span> os.listdir(directory_path):</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">26</span>        <span class=\"pl-k\">if</span> file_name.endswith(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>.md<span class=\"pl-pds\">'</span></span>):</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">27</span>            file_path <span class=\"pl-k\">=</span> os.path.join(directory_path, file_name)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">28</span>            title, html <span class=\"pl-k\">=</span> markdown_to_html(file_path)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">29</span>            results.append((title, html))</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">30</span>    <span class=\"pl-k\">return</span> results</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">31</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">32</span><span class=\"pl-c\"># Function to create a JWT token</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">33</span><span class=\"pl-k\">def</span> <span class=\"pl-en\">create_jwt</span>(<span class=\"pl-smi\">api_key</span>):</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">34</span>    key_id, secret <span class=\"pl-k\">=</span> api_key.split(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>:<span class=\"pl-pds\">'</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">35</span>    iat <span class=\"pl-k\">=</span> <span class=\"pl-c1\">int</span>(datetime.datetime.now().timestamp())</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">36</span>    header <span class=\"pl-k\">=</span> {<span class=\"pl-s\"><span class=\"pl-pds\">'</span>alg<span class=\"pl-pds\">'</span></span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>HS256<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>kid<span class=\"pl-pds\">'</span></span>: key_id}</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">37</span>    payload <span class=\"pl-k\">=</span> {</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">38</span>        <span class=\"pl-s\"><span class=\"pl-pds\">'</span>iat<span class=\"pl-pds\">'</span></span>: iat,</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">39</span>        <span class=\"pl-s\"><span class=\"pl-pds\">'</span>exp<span class=\"pl-pds\">'</span></span>: iat <span class=\"pl-k\">+</span> <span class=\"pl-c1\">300</span>,</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">40</span>        <span class=\"pl-s\"><span class=\"pl-pds\">'</span>aud<span class=\"pl-pds\">'</span></span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/v3/admin/<span class=\"pl-pds\">'</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">41</span>    }</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">42</span>    token <span class=\"pl-k\">=</span> jwt.encode(payload, <span class=\"pl-c1\">bytes</span>.fromhex(secret), <span class=\"pl-v\">algorithm</span><span class=\"pl-k\">=</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span>HS256<span class=\"pl-pds\">'</span></span>, <span class=\"pl-v\">headers</span><span class=\"pl-k\">=</span>header)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">43</span>    <span class=\"pl-k\">return</span> token</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">44</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">45</span>results <span class=\"pl-k\">=</span> process_markdown_directory(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>./content<span class=\"pl-pds\">'</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">46</span>jwt_token <span class=\"pl-k\">=</span> create_jwt(admin_api_key)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">47</span><span class=\"pl-k\">for</span> title, html <span class=\"pl-k\">in</span> results:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">48</span>    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-k\">f</span><span class=\"pl-pds\">\"</span>Title: </span><span class=\"pl-c1\">{</span>title<span class=\"pl-c1\">}</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">49</span>    <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-k\">f</span><span class=\"pl-pds\">\"</span>HTML: </span><span class=\"pl-c1\">{</span>html<span class=\"pl-c1\">}</span><span class=\"pl-cce\">\\n</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">50</span>    <span class=\"pl-c\"># Post data</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">51</span>    post_data <span class=\"pl-k\">=</span> {</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">52</span>        <span class=\"pl-s\"><span class=\"pl-pds\">'</span>posts<span class=\"pl-pds\">'</span></span>: [{</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">53</span>            <span class=\"pl-s\"><span class=\"pl-pds\">'</span>title<span class=\"pl-pds\">'</span></span>: title,</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">54</span>            <span class=\"pl-s\"><span class=\"pl-pds\">'</span>html<span class=\"pl-pds\">'</span></span>: html,</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">55</span>            <span class=\"pl-s\"><span class=\"pl-pds\">'</span>status<span class=\"pl-pds\">'</span></span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>draft<span class=\"pl-pds\">'</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">56</span>        }]</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">57</span>    }</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">58</span>    headers <span class=\"pl-k\">=</span> {</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">59</span>        <span class=\"pl-s\"><span class=\"pl-pds\">'</span>Authorization<span class=\"pl-pds\">'</span></span>: <span class=\"pl-s\"><span class=\"pl-k\">f</span><span class=\"pl-pds\">'</span>Ghost </span><span class=\"pl-c1\">{</span>jwt_token<span class=\"pl-c1\">}</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span></span>,</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">60</span>        <span class=\"pl-s\"><span class=\"pl-pds\">'</span>Content-Type<span class=\"pl-pds\">'</span></span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>application/json<span class=\"pl-pds\">'</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">61</span>    }</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">62</span>    response <span class=\"pl-k\">=</span> requests.post(api_url, <span class=\"pl-v\">json</span><span class=\"pl-k\">=</span>post_data, <span class=\"pl-v\">headers</span><span class=\"pl-k\">=</span>headers)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">63</span>    <span class=\"pl-k\">if</span> response.status_code <span class=\"pl-k\">==</span> <span class=\"pl-c1\">201</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">64</span>        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>Post created successfully!<span class=\"pl-pds\">'</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">65</span>    <span class=\"pl-k\">else</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">66</span>        <span class=\"pl-c1\">print</span>(<span class=\"pl-s\"><span class=\"pl-k\">f</span><span class=\"pl-pds\">'</span>Failed to create post: </span><span class=\"pl-c1\">{</span>response.status_code<span class=\"pl-c1\">}</span><span class=\"pl-s\"><span class=\"pl-pds\">'</span></span>)</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">67</span>        <span class=\"pl-c1\">print</span>(response.json())</span>\n</code></pre></div>","title":"Creating a Ghost CMS Site from markdown files","date":"2025-01-15","tags":"ghost cms, markdown, tinkering, snippets"}},"__N_SSG":true}