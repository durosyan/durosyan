{"pageProps":{"postData":{"id":"docker","contentHtml":"<h1>Docker System Services: Simplifying Complex Deployments</h1>\n<p>In the rapidly evolving world of containerization and microservice architectures, Docker has established itself as an essential tool for developers seeking flexibility and efficiency in managing applications. While Docker Swarm offers the promise of seamless scaling and automation, it inherently introduces a layer of complexity that may not be necessary for every application. This blog post explores the idea of hosting critical services on individual machines to strike a balance between manageability and performance.</p>\n<h2>A Modular Approach</h2>\n<p>The transition to a more modular hosting setup involves a strategic distribution of services across dedicated machines. One might consider hosting GitLab, a prominent DevOps tool, on a separate machine from other applications. This allows for an isolated and optimized build environment, paving the way for a stable \"Production\" Environment.</p>\n<h3>Hosting GitLab</h3>\n<p>The marriage between Docker and GitLab is a powerful one, enabling seamless CI/CD operations. Through a straightforward Docker Compose setup, GitLab can be deployed using the following configuration:</p>\n<div class=\"hl hl-yaml\"><div class=\"hl-header\"><div class=\"hl-language\"><span>yaml</span></div></div><pre id=\"MC42ODIwOTA5\" style=\"--hl-line-number-gutter-factor: 2\"><code tabindex=\"0\"><span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">1</span><span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>3.6<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">2</span><span class=\"pl-ent\">services</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">3</span>  <span class=\"pl-ent\">gitlab</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">4</span>    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">gitlab/gitlab-ee:latest</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">5</span>    <span class=\"pl-ent\">ports</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">6</span>      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>22:22<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">7</span>      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>80:80<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">8</span>      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>443:443<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">9</span>    <span class=\"pl-ent\">volumes</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">10</span>      - <span class=\"pl-s\">$GITLAB_HOME/data:/var/opt/gitlab</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">11</span>      - <span class=\"pl-s\">$GITLAB_HOME/logs:/var/log/gitlab</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">12</span>      - <span class=\"pl-s\">$GITLAB_HOME/config:/etc/gitlab</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">13</span>    <span class=\"pl-ent\">shm_size</span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>256m<span class=\"pl-pds\">'</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">14</span>    <span class=\"pl-ent\">environment</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">15</span>      <span class=\"pl-ent\">GITLAB_OMNIBUS_CONFIG</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>from_file('/omnibus_config.rb')<span class=\"pl-pds\">\"</span></span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">16</span>    <span class=\"pl-ent\">configs</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">17</span>      - <span class=\"pl-ent\">source</span>: <span class=\"pl-s\">gitlab</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">18</span>        <span class=\"pl-ent\">target</span>: <span class=\"pl-s\">/omnibus_config.rb</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">19</span>    <span class=\"pl-ent\">secrets</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">20</span>      - <span class=\"pl-s\">gitlab_root_password</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">21</span>  <span class=\"pl-ent\">gitlab-runner</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">22</span>    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">gitlab/gitlab-runner:alpine</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">23</span>    <span class=\"pl-ent\">deploy</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">24</span>      <span class=\"pl-ent\">mode</span>: <span class=\"pl-s\">replicated</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">25</span>      <span class=\"pl-ent\">replicas</span>: <span class=\"pl-c1\">4</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">26</span><span class=\"pl-ent\">configs</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">27</span>  <span class=\"pl-ent\">gitlab</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">28</span>    <span class=\"pl-ent\">file</span>: <span class=\"pl-s\">./gitlab.rb</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">29</span><span class=\"pl-ent\">secrets</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">30</span>  <span class=\"pl-ent\">gitlab_root_password</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">31</span>    <span class=\"pl-ent\">file</span>: <span class=\"pl-s\">./root_password.txt</span></span>\n</code></pre></div>\n<p>This configuration ensures secure and efficient handling of repositories with seamless scalability via GitLab runners.</p>\n<h3>Introducing Unifi and ProjectSend</h3>\n<p>Beyond GitLab, Unifi and ProjectSend serve diverse needs. Unifi's Docker configuration supports robust network management, integrating MongoDB effortlessly to scale with user demands. Here's a simplified version of the configuration for Unifi:</p>\n<div class=\"hl hl-yaml\"><div class=\"hl-header\"><div class=\"hl-language\"><span>yaml</span></div></div><pre id=\"MC40MDYzMDcx\" style=\"--hl-line-number-gutter-factor: 2\"><code tabindex=\"0\"><span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">1</span><span class=\"pl-ent\">image</span>: <span class=\"pl-s\">lscr.io/linuxserver/unifi-network-application:latest</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">2</span><span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">unifi-network-application</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">3</span><span class=\"pl-ent\">environment</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">4</span>  - <span class=\"pl-s\">PUID=1000</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">5</span>  - <span class=\"pl-s\">PGID=1000</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">6</span>  - <span class=\"pl-s\">TZ=Etc/UTC</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">7</span>  - <span class=\"pl-s\">MONGO_USER=unifi</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">8</span>  - <span class=\"pl-s\">MONGO_PASS=</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">9</span>  - <span class=\"pl-s\">MONGO_HOST=unifi-db</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">10</span>  - <span class=\"pl-s\">MONGO_PORT=27017</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">11</span>  - <span class=\"pl-s\">MONGO_DBNAME=unifi</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">12</span><span class=\"pl-ent\">volumes</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">13</span>  - <span class=\"pl-s\">/path/to/data:/config</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">14</span><span class=\"pl-ent\">ports</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">15</span>  - <span class=\"pl-c1\">8443:8443</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">16</span>  - <span class=\"pl-s\">3478:3478/udp</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">17</span>  - <span class=\"pl-s\">10001:10001/udp</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">18</span><span class=\"pl-ent\">restart</span>: <span class=\"pl-s\">unless-stopped</span></span>\n</code></pre></div>\n<p>Similarly, ProjectSend acts as a convenient Dropbox alternative, facilitating file transfers with unmatched ease:</p>\n<div class=\"hl hl-yaml\"><div class=\"hl-header\"><div class=\"hl-language\"><span>yaml</span></div></div><pre id=\"MC4yMTY4MzEz\" style=\"--hl-line-number-gutter-factor: 2\"><code tabindex=\"0\"><span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">1</span><span class=\"pl-ent\">image</span>: <span class=\"pl-s\">lscr.io/linuxserver/projectsend:latest</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">2</span><span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">projectsend</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">3</span><span class=\"pl-ent\">environment</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">4</span>  - <span class=\"pl-s\">PUID=1000</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">5</span>  - <span class=\"pl-s\">PGID=1000</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">6</span>  - <span class=\"pl-s\">TZ=Etc/UTC</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">7</span>  - <span class=\"pl-s\">MAX_UPLOAD=5000</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">8</span><span class=\"pl-ent\">volumes</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">9</span>  - <span class=\"pl-s\">&#x3C;path to data>:/config</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">10</span>  - <span class=\"pl-s\">&#x3C;path to data>:/data</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">11</span><span class=\"pl-ent\">ports</span>:</span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">12</span>  - <span class=\"pl-c1\">80:80</span></span>\n<span class=\"line\"><span class=\"line-number\" aria-hidden=\"true\">13</span><span class=\"pl-ent\">restart</span>: <span class=\"pl-s\">unless-stopped</span></span>\n</code></pre></div>\n<h2>Conclusion</h2>\n<p>In conclusion, the judicious deployment of Docker services across dedicated machines can simplify the complexity commonly associated with a containerized environment. This modularity not only enhances efficiency but also provides the flexibility necessary to tailor the infrastructure to specific needs and scale as required. As organizations continue to embrace microservices, this strategic approach to Docker deployment ensures a robust, adaptable, and manageable system architecture.</p>","title":"Docker","date":"2025-01-15","tags":"engineering, tinkering, snippets"}},"__N_SSG":true}